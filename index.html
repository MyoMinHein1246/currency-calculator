<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Currency Seller Calculator</title>
    <style>
        :root {
            --color-primary: #2186AB;
            --color-primary-hover: #1a6a8f;
            --color-primary-active: #0d4a6f;
            --color-bg: #0f172a;
            --color-surface: #1a2332;
            --color-surface-alt: #252d3d;
            --color-text: #e0e7ff;
            --color-text-secondary: #a0aec0;
            --color-border: #3a4457;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
            --color-info: #3b82f6;
            --color-highlight: #8b5cf6;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
        }

        body {
            overflow-y: auto;
            padding: 12px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 24px;
        }

        h1 {
            margin: 0 0 4px 0;
            font-size: 28px;
            font-weight: 600;
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (min-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 16px 0;
            color: var(--color-highlight);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--color-text);
        }

        .label-helper {
            font-size: 12px;
            color: var(--color-text-secondary);
            font-weight: 400;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            background: var(--color-surface-alt);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text);
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(33, 134, 171, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        @media (min-width: 640px) {
            .form-row {
                grid-template-columns: 1fr 1fr;
            }
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 20px;
        }

        button {
            padding: 12px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            grid-column: span 2;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-primary:active {
            background: var(--color-primary-active);
        }

        .btn-secondary {
            background: var(--color-surface-alt);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: var(--color-border);
        }

        .btn-danger {
            background: var(--color-error);
            color: white;
        }

        .btn-danger:hover {
            background: #d33333;
        }

        .btn-success {
            background: var(--color-success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .result-box {
            background: var(--color-surface-alt);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }

        .result-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .result-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-info);
            word-break: break-word;
        }

        .result-value.success {
            color: var(--color-success);
        }

        .result-value.warning {
            color: var(--color-warning);
        }

        .profile-item {
            background: var(--color-surface-alt);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-item-content {
            flex: 1;
        }

        .profile-item-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .profile-item-meta {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .profile-item-actions {
            display: flex;
            gap: 6px;
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
            white-space: nowrap;
        }

        .tab-group {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--color-border);
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 14px;
            border: none;
            background: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--color-text);
        }

        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .currency-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 8px;
            margin-bottom: 12px;
        }

        .currency-option {
            background: var(--color-surface-alt);
            border: 2px solid var(--color-border);
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .currency-option:hover {
            border-color: var(--color-primary);
            background: var(--color-border);
        }

        .currency-option.selected {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
        }

        .currency-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .currency-rate {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .stat {
            background: var(--color-surface-alt);
            border-left: 3px solid var(--color-primary);
            padding: 12px;
            border-radius: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-text);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-suffix {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-secondary);
            font-size: 13px;
            pointer-events: none;
        }

        .input-wrapper input {
            padding-right: 32px;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        @media (max-width: 640px) {
            h1 {
                font-size: 22px;
            }

            .main-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                grid-template-columns: 1fr;
            }

            .btn-primary {
                grid-column: span 1;
            }

            .currency-list {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üí∞ Game Currency Seller Calculator</h1>
            <p class="subtitle">Professional profile management and transaction calculation</p>
        </header>

        <!-- Main Calculator Section -->
        <div class="main-grid">
            <!-- Profile Management -->
            <div class="card">
                <h2 class="card-title">üìã Profiles</h2>
                
                <div class="tab-group">
                    <button class="tab active" onclick="switchTab(this, 'profile-list')">All</button>
                    <button class="tab" onclick="switchTab(this, 'profile-create')">Create New</button>
                </div>

                <div id="profile-list" class="tab-content active">
                    <div id="profiles-container">
                        <div class="empty-state">
                            <div class="empty-state-icon">üéÆ</div>
                            <p>No profiles yet. Create your first profile to get started!</p>
                        </div>
                    </div>
                </div>

                <div id="profile-create" class="tab-content">
                    <div class="form-group">
                        <label>Profile Name</label>
                        <input type="text" id="profileName" placeholder="e.g., Main Account, Reseller 1">
                    </div>

                    <div class="form-group">
                        <label>Game Title</label>
                        <input type="text" id="gameName" placeholder="e.g., World of Warcraft, Final Fantasy XIV">
                    </div>

                    <div class="form-group">
                        <label>Currency Type</label>
                        <select id="currencyType">
                            <option value="gold">Gold</option>
                            <option value="gems">Gems</option>
                            <option value="crystal">Crystal</option>
                            <option value="points">Points</option>
                            <option value="coins">Coins</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <div class="form-group" id="customCurrencyGroup" style="display:none;">
                        <label>Custom Currency Name</label>
                        <input type="text" id="customCurrencyName" placeholder="e.g., Primogems, Apex Coins">
                    </div>

                    <div class="form-group">
                        <label>Base Exchange Rate (Currency per $1 USD) <span class="label-helper">e.g., 100 gold = $1</span></label>
                        <input type="number" id="exchangeRate" placeholder="100" step="0.01" min="0">
                    </div>

                    <div class="form-group">
                        <label>Minimum Order Amount</label>
                        <input type="number" id="minOrder" placeholder="1000" step="1" min="0">
                    </div>

                    <div class="form-group">
                        <label>Maximum Order Amount <span class="label-helper">(leave blank for unlimited)</span></label>
                        <input type="number" id="maxOrder" placeholder="1000000" step="1" min="0">
                    </div>

                    <div class="form-group">
                        <label>Profit Margin (%)</label>
                        <input type="number" id="profitMargin" placeholder="10" step="0.1" min="0" max="100">
                    </div>

                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="profileNotes" placeholder="Add any special info about this profile..."></textarea>
                    </div>

                    <button class="btn-primary" onclick="createProfile()">Create Profile</button>
                </div>
            </div>

            <!-- Quick Calculator -->
            <div class="card">
                <h2 class="card-title">üßÆ Quick Calculator</h2>
                
                <div class="form-group">
                    <label>Select Profile</label>
                    <select id="selectedProfile">
                        <option value="">-- Choose Profile --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label id="amountLabel">Amount</label>
                    <div class="input-wrapper">
                        <input type="number" id="calculateAmount" placeholder="0" step="1" min="0" oninput="calculatePrice()">
                        <span class="input-suffix" id="currencySuffix">units</span>
                    </div>
                </div>

                <div class="results-grid" id="calculatorResults">
                    <div class="result-box">
                        <div class="result-label">Base USD</div>
                        <div class="result-value" id="baseUSD">$0.00</div>
                    </div>
                    <div class="result-box">
                        <div class="result-label">With Margin</div>
                        <div class="result-value success" id="sellingPrice">$0.00</div>
                    </div>
                    <div class="result-box">
                        <div class="result-label">Your Profit</div>
                        <div class="result-value warning" id="profitAmount">$0.00</div>
                    </div>
                </div>

                <button class="btn-secondary" onclick="copyCalculation()" style="width: 100%; margin-top: 12px;">üìã Copy Result</button>
            </div>
        </div>

        <!-- Advanced Features -->
        <div class="card" style="margin-bottom: 20px;">
            <h2 class="card-title">‚öôÔ∏è Advanced Tools</h2>
            
            <div class="tab-group">
                <button class="tab active" onclick="switchTab(this, 'batch-calc')">Batch Calculator</button>
                <button class="tab" onclick="switchTab(this, 'bulk-estimate')">Bulk Estimate</button>
                <button class="tab" onclick="switchTab(this, 'profit-analyzer')">Profit Analyzer</button>
            </div>

            <!-- Batch Calculator -->
            <div id="batch-calc" class="tab-content active">
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="batchQuantity" placeholder="10" min="1" step="1">
                    </div>
                    <div class="form-group">
                        <label>Amount per Order</label>
                        <input type="number" id="batchAmount" placeholder="5000" min="0" step="1">
                    </div>
                </div>
                <button class="btn-success" onclick="calculateBatch()" style="width: 100%;">Calculate Batch</button>
                <div class="stats-row" id="batchResults" style="display:none; margin-top: 16px;">
                    <div class="stat">
                        <div class="stat-label">Total Currency</div>
                        <div class="stat-value" id="batchTotalCurrency">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Total USD (Base)</div>
                        <div class="stat-value" id="batchTotalBase">$0.00</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="batchTotalRevenue">$0.00</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Total Profit</div>
                        <div class="stat-value" id="batchTotalProfit">$0.00</div>
                    </div>
                </div>
            </div>

            <!-- Bulk Estimate -->
            <div id="bulk-estimate" class="tab-content">
                <div class="form-row">
                    <div class="form-group">
                        <label>Amount Invested (USD)</label>
                        <input type="number" id="bulkInvestment" placeholder="1000" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>Profit Margin Override (%)</label>
                        <input type="number" id="bulkMarginOverride" placeholder="auto" step="0.1" min="0">
                    </div>
                </div>
                <button class="btn-success" onclick="calculateBulkEstimate()" style="width: 100%;">Estimate</button>
                <div class="stats-row" id="bulkResults" style="display:none; margin-top: 16px;">
                    <div class="stat">
                        <div class="stat-label">Currency Acquired</div>
                        <div class="stat-value" id="bulkCurrency">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Base Cost</div>
                        <div class="stat-value" id="bulkBaseCost">$0.00</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Selling Revenue</div>
                        <div class="stat-value" id="bulkRevenue">$0.00</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Net Profit</div>
                        <div class="stat-value" id="bulkProfit">$0.00</div>
                    </div>
                </div>
            </div>

            <!-- Profit Analyzer -->
            <div id="profit-analyzer" class="tab-content">
                <div class="form-group">
                    <label>Amount Sold (Currency)</label>
                    <input type="number" id="amountSold" placeholder="50000" min="0" step="1">
                </div>
                <div class="form-group">
                    <label>Revenue Received (USD)</label>
                    <input type="number" id="revenueReceived" placeholder="500" step="0.01" min="0">
                </div>
                <button class="btn-success" onclick="analyzeProfit()" style="width: 100%;">Analyze</button>
                <div class="stats-row" id="profitAnalysisResults" style="display:none; margin-top: 16px;">
                    <div class="stat">
                        <div class="stat-label">Actual Rate (per $1)</div>
                        <div class="stat-value" id="actualRate">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Base Value</div>
                        <div class="stat-value" id="baseValue">$0.00</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Actual Profit</div>
                        <div class="stat-value" id="actualProfit">$0.00</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Margin Achieved</div>
                        <div class="stat-value" id="marginAchieved">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings & Export -->
        <div class="card">
            <h2 class="card-title">üîß Settings</h2>
            
            <div class="tab-group">
                <button class="tab active" onclick="switchTab(this, 'settings-general')">General</button>
                <button class="tab" onclick="switchTab(this, 'settings-data')">Data</button>
            </div>

            <div id="settings-general" class="tab-content active">
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="darkMode" checked onchange="toggleDarkMode()">
                        Dark Mode (Currently On)
                    </label>
                </div>
                <div class="form-group">
                    <label>Currency Display</label>
                    <select id="currencyDisplay">
                        <option value="usd">USD ($)</option>
                        <option value="eur">EUR (‚Ç¨)</option>
                        <option value="gbp">GBP (¬£)</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-group" id="customCurrencyDisplay" style="display:none;">
                    <label>Custom Currency Symbol</label>
                    <input type="text" id="customCurrencySymbol" placeholder="‡∏ø" maxlength="3">
                </div>
                <button class="btn-secondary" onclick="saveSettings()" style="width: 100%;">üíæ Save Settings</button>
            </div>

            <div id="settings-data" class="tab-content">
                <div class="form-group">
                    <label>Backup & Restore</label>
                    <div class="button-group" style="margin-top: 8px;">
                        <button class="btn-secondary" onclick="exportData()">üì• Export Data</button>
                        <button class="btn-secondary" onclick="triggerImport()">üì§ Import Data</button>
                    </div>
                    <input type="file" id="importFile" accept=".json" style="display:none;" onchange="importData(event)">
                </div>
                <button class="btn-danger" onclick="clearAllData()" style="width: 100%; margin-top: 12px;">üóëÔ∏è Clear All Data</button>
            </div>
        </div>
    </div>

    <script>
        // State Management
        let profiles = [];
        let currentCurrency = '$';

        // Initialize
        function init() {
            loadProfiles();
            loadSettings();
            updateProfileSelect();
            document.getElementById('currencyType').addEventListener('change', function() {
                document.getElementById('customCurrencyGroup').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
            document.getElementById('currencyDisplay').addEventListener('change', function() {
                document.getElementById('customCurrencyDisplay').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
        }

        // Profile Management
        function createProfile() {
            const name = document.getElementById('profileName').value.trim();
            const game = document.getElementById('gameName').value.trim();
            const currencyType = document.getElementById('currencyType').value;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 0;
            const minOrder = parseFloat(document.getElementById('minOrder').value) || 0;
            const maxOrder = parseFloat(document.getElementById('maxOrder').value) || Infinity;
            const profitMargin = parseFloat(document.getElementById('profitMargin').value) || 0;
            const notes = document.getElementById('profileNotes').value.trim();

            if (!name || !game || exchangeRate <= 0) {
                alert('Please fill in all required fields');
                return;
            }

            const customCurrency = currencyType === 'custom' 
                ? document.getElementById('customCurrencyName').value.trim() 
                : currencyType;

            const profile = {
                id: Date.now(),
                name,
                game,
                currencyType: customCurrency,
                exchangeRate,
                minOrder,
                maxOrder,
                profitMargin,
                notes,
                created: new Date().toLocaleString()
            };

            profiles.push(profile);
            saveProfiles();
            renderProfiles();
            updateProfileSelect();
            clearProfileForm();
            switchTab(document.querySelector('.tab'), 'profile-list');
        }

        function deleteProfile(id) {
            if (confirm('Are you sure? This cannot be undone.')) {
                profiles = profiles.filter(p => p.id !== id);
                saveProfiles();
                renderProfiles();
                updateProfileSelect();
            }
        }

        function renderProfiles() {
            const container = document.getElementById('profiles-container');
            if (profiles.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üéÆ</div>
                        <p>No profiles yet. Create your first profile to get started!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = profiles.map(p => `
                <div class="profile-item">
                    <div class="profile-item-content">
                        <div class="profile-item-name">${p.name}</div>
                        <div class="profile-item-meta">
                            ${p.game} ‚Ä¢ ${p.currencyType} ‚Ä¢ ${p.exchangeRate}/$ ‚Ä¢ Margin: ${p.profitMargin}%
                        </div>
                    </div>
                    <div class="profile-item-actions">
                        <button class="btn-secondary btn-sm" onclick="loadProfile(${p.id})">Use</button>
                        <button class="btn-danger btn-sm" onclick="deleteProfile(${p.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadProfile(id) {
            const profile = profiles.find(p => p.id === id);
            if (profile) {
                document.getElementById('selectedProfile').value = id;
                calculatePrice();
            }
        }

        function updateProfileSelect() {
            const select = document.getElementById('selectedProfile');
            select.innerHTML = '<option value="">-- Choose Profile --</option>' + 
                profiles.map(p => `<option value="${p.id}">${p.name} (${p.game})</option>`).join('');
        }

        function clearProfileForm() {
            document.getElementById('profileName').value = '';
            document.getElementById('gameName').value = '';
            document.getElementById('currencyType').value = 'gold';
            document.getElementById('exchangeRate').value = '';
            document.getElementById('minOrder').value = '';
            document.getElementById('maxOrder').value = '';
            document.getElementById('profitMargin').value = '';
            document.getElementById('profileNotes').value = '';
        }

        // Calculator Functions
        function calculatePrice() {
            const profileId = document.getElementById('selectedProfile').value;
            if (!profileId) return;

            const profile = profiles.find(p => p.id == profileId);
            const amount = parseFloat(document.getElementById('calculateAmount').value) || 0;

            if (!profile) return;

            document.getElementById('amountLabel').textContent = `Amount (${profile.currencyType})`;
            document.getElementById('currencySuffix').textContent = profile.currencyType;

            const baseUSD = amount / profile.exchangeRate;
            const margin = 1 + (profile.profitMargin / 100);
            const sellingPrice = baseUSD * margin;
            const profit = sellingPrice - baseUSD;

            document.getElementById('baseUSD').textContent = formatCurrency(baseUSD);
            document.getElementById('sellingPrice').textContent = formatCurrency(sellingPrice);
            document.getElementById('profitAmount').textContent = formatCurrency(profit);
        }

        function calculateBatch() {
            const profileId = document.getElementById('selectedProfile').value;
            if (!profileId) {
                alert('Please select a profile first');
                return;
            }

            const profile = profiles.find(p => p.id == profileId);
            const quantity = parseInt(document.getElementById('batchQuantity').value) || 0;
            const amount = parseFloat(document.getElementById('batchAmount').value) || 0;

            if (quantity <= 0 || amount <= 0) {
                alert('Please enter valid quantities');
                return;
            }

            const totalCurrency = quantity * amount;
            const totalBaseUSD = totalCurrency / profile.exchangeRate;
            const margin = 1 + (profile.profitMargin / 100);
            const totalRevenue = totalBaseUSD * margin;
            const totalProfit = totalRevenue - totalBaseUSD;

            document.getElementById('batchTotalCurrency').textContent = formatNumber(totalCurrency);
            document.getElementById('batchTotalBase').textContent = formatCurrency(totalBaseUSD);
            document.getElementById('batchTotalRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('batchTotalProfit').textContent = formatCurrency(totalProfit);
            document.getElementById('batchResults').style.display = 'grid';
        }

        function calculateBulkEstimate() {
            const profileId = document.getElementById('selectedProfile').value;
            if (!profileId) {
                alert('Please select a profile first');
                return;
            }

            const profile = profiles.find(p => p.id == profileId);
            const investment = parseFloat(document.getElementById('bulkInvestment').value) || 0;
            const marginOverride = document.getElementById('bulkMarginOverride').value;
            const margin = marginOverride ? (1 + (parseFloat(marginOverride) / 100)) : (1 + (profile.profitMargin / 100));

            const currency = investment * profile.exchangeRate;
            const revenue = investment * margin;
            const profit = revenue - investment;

            document.getElementById('bulkCurrency').textContent = formatNumber(currency);
            document.getElementById('bulkBaseCost').textContent = formatCurrency(investment);
            document.getElementById('bulkRevenue').textContent = formatCurrency(revenue);
            document.getElementById('bulkProfit').textContent = formatCurrency(profit);
            document.getElementById('bulkResults').style.display = 'grid';
        }

        function analyzeProfit() {
            const amountSold = parseFloat(document.getElementById('amountSold').value) || 0;
            const revenueReceived = parseFloat(document.getElementById('revenueReceived').value) || 0;

            if (amountSold <= 0 || revenueReceived <= 0) {
                alert('Please enter valid amounts');
                return;
            }

            const actualRate = amountSold / revenueReceived;
            const baseValue = revenueReceived; // Revenue = cost (approximately)
            const profit = revenueReceived - baseValue;
            const marginAchieved = (profit / baseValue * 100).toFixed(2);

            document.getElementById('actualRate').textContent = formatNumber(actualRate);
            document.getElementById('baseValue').textContent = formatCurrency(baseValue);
            document.getElementById('actualProfit').textContent = formatCurrency(profit);
            document.getElementById('marginAchieved').textContent = marginAchieved + '%';
            document.getElementById('profitAnalysisResults').style.display = 'grid';
        }

        function copyCalculation() {
            const baseUSD = document.getElementById('baseUSD').textContent;
            const sellingPrice = document.getElementById('sellingPrice').textContent;
            const profit = document.getElementById('profitAmount').textContent;
            const text = `Base: ${baseUSD} | Selling: ${sellingPrice} | Profit: ${profit}`;
            navigator.clipboard.writeText(text);
            alert('Copied to clipboard!');
        }

        // Tab Management
        function switchTab(btn, tabName) {
            const tabs = btn.parentElement.querySelectorAll('.tab');
            const contents = btn.parentElement.parentElement.querySelectorAll('.tab-content');
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Settings
        function toggleDarkMode() {
            const isDark = document.getElementById('darkMode').checked;
            document.body.style.filter = isDark ? 'none' : 'invert(1)';
            localStorage.setItem('darkMode', isDark);
        }

        function saveSettings() {
            const settings = {
                darkMode: document.getElementById('darkMode').checked,
                currencyDisplay: document.getElementById('currencyDisplay').value,
                customSymbol: document.getElementById('customCurrencySymbol').value
            };
            localStorage.setItem('appSettings', JSON.stringify(settings));
            alert('Settings saved!');
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
            if (settings.darkMode !== undefined) {
                document.getElementById('darkMode').checked = settings.darkMode;
            }
            if (settings.currencyDisplay) {
                document.getElementById('currencyDisplay').value = settings.currencyDisplay;
            }
        }

        // Data Management
        function saveProfiles() {
            localStorage.setItem('profiles', JSON.stringify(profiles));
        }

        function loadProfiles() {
            const saved = localStorage.getItem('profiles');
            profiles = saved ? JSON.parse(saved) : [];
            renderProfiles();
        }

        function exportData() {
            const data = {
                profiles,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `profile-calculator-backup-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function triggerImport() {
            document.getElementById('importFile').click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.profiles && Array.isArray(data.profiles)) {
                        profiles = data.profiles;
                        saveProfiles();
                        renderProfiles();
                        updateProfileSelect();
                        alert('Data imported successfully!');
                    } else {
                        alert('Invalid file format');
                    }
                } catch (err) {
                    alert('Error importing file: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('This will delete all profiles and data. This cannot be undone!')) {
                profiles = [];
                localStorage.clear();
                saveProfiles();
                renderProfiles();
                updateProfileSelect();
                clearProfileForm();
                alert('All data cleared');
            }
        }

        // Utilities
        function formatCurrency(value) {
            return currentCurrency + value.toFixed(2);
        }

        function formatNumber(value) {
            return value.toLocaleString('en-US', { 
                maximumFractionDigits: 0,
                minimumFractionDigits: 0
            });
        }

        // Start
        init();
    </script>
</body>
</html>
