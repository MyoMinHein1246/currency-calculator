<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />

    <style>
      [x-cloak] {
        display: none !important;
      }
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type="number"] {
        -moz-appearance: textfield;
      }
      .anim-pulse {
        animation: pulse-blue 2s infinite;
      }
      @keyframes pulse-blue {
        0% {
          box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
        }
        70% {
          box-shadow: 0 0 0 6px rgba(99, 102, 241, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
        }
      }

      /* Liquid glass iPhone-style cards */
      .glass-border {
        position: relative;
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.04)
        );
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .glass-border::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        padding: 1px;
        background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.35) 0%,
          rgba(255, 255, 255, 0.1) 25%,
          rgba(255, 255, 255, 0.04) 50%,
          rgba(255, 255, 255, 0.1) 75%,
          rgba(255, 255, 255, 0.35) 100%
        );
        -webkit-mask: linear-gradient(#fff 0 0) content-box,
          linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        pointer-events: none;
      }

      .dark .glass-border {
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: linear-gradient(
          135deg,
          rgba(15, 23, 42, 0.85),
          rgba(15, 23, 42, 0.65)
        );
      }

      .dark .glass-border::before {
        background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.18) 0%,
          rgba(255, 255, 255, 0.06) 25%,
          rgba(255, 255, 255, 0.02) 50%,
          rgba(255, 255, 255, 0.06) 75%,
          rgba(255, 255, 255, 0.18) 100%
        );
      }

      /* Subtle hover lift */
      .glass-hover {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .glass-hover:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 30px -12px rgba(15, 23, 42, 0.45),
          0 0 0 1px rgba(255, 255, 255, 0.35) inset;
      }

      .dark .glass-hover:hover {
        box-shadow: 0 14px 30px -12px rgba(15, 23, 42, 0.8),
          0 0 0 1px rgba(148, 163, 184, 0.35) inset;
      }

      /* Glass inputs */
      .glass-input {
        background: rgba(255, 255, 255, 0.65) !important;
        border: 1px solid rgba(148, 163, 184, 0.5) !important;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }

      .dark .glass-input {
        background: rgba(15, 23, 42, 0.7) !important;
        border: 1px solid rgba(148, 163, 184, 0.35) !important;
      }

      .glass-input:focus {
        background: rgba(255, 255, 255, 0.9) !important;
        border-color: rgba(129, 140, 248, 0.7) !important;
      }

      .dark .glass-input:focus {
        background: rgba(15, 23, 42, 0.9) !important;
        border-color: rgba(129, 140, 248, 0.8) !important;
      }
    </style>

    <title>Pro RMT Calculator v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"
    ></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: { extend: { colors: { slate: { 850: "#151e2e" } } } },
      };
    </script>
    <style>
      [x-cloak] {
        display: none !important;
      }
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type="number"] {
        -moz-appearance: textfield;
      }
      .anim-pulse {
        animation: pulse-blue 2s infinite;
      }
      @keyframes pulse-blue {
        0% {
          box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
        }
        70% {
          box-shadow: 0 0 0 6px rgba(99, 102, 241, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
        }
      }
    </style>
  </head>
  <body
    class="bg-gray-100 text-gray-800 transition-colors duration-200"
    x-data="appData()"
    x-init="initData()"
    :class="{ 'dark bg-slate-900 text-gray-100': darkMode }"
  >
    <nav
      class="bg-white dark:bg-slate-800 shadow-md p-4 sticky top-0 z-50 glass-border"
    >
      <div class="max-w-5xl mx-auto flex justify-between items-center">
        <div class="flex items-center gap-2">
          <span class="text-2xl">üßÆ</span>
          <h1 class="font-bold text-xl tracking-tight">
            Currency<span class="text-indigo-500">Calc</span>
            <span class="text-xs text-gray-400 font-normal">PRO</span>
          </h1>
        </div>
        <div class="flex items-center gap-2">
          <!-- Import/Export Buttons -->
          <button
            @click="exportData()"
            class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 transition"
            title="Export Data"
          >
            <span class="text-lg">üíæ</span>
          </button>
          <button
            @click="$refs.importFile.click()"
            class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 transition"
            title="Import Data"
          >
            <span class="text-lg">üìÇ</span>
          </button>
          <input
            type="file"
            x-ref="importFile"
            @change="importData($event)"
            accept=".json"
            class="hidden"
          />
          <button
            @click="toggleDark()"
            class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 transition"
          >
            <span x-show="!darkMode">üåô</span>
            <span x-show="darkMode">‚òÄÔ∏è</span>
          </button>
        </div>
      </div>
    </nav>

    <main class="max-w-5xl mx-auto p-4 pb-20">
      <!-- Profile Management -->
      <div
        class="bg-white dark:bg-slate-800 rounded-lg shadow-lg p-4 mb-4 glass-border glass-hover"
      >
        <div class="flex items-center justify-between mb-3">
          <div>
            <p class="text-sm text-gray-500 dark:text-gray-400">
              Active Profile
            </p>
            <p
              class="font-bold text-lg"
              x-text="activeProfile.name"
            ></p>
          </div>
          <div class="flex gap-2">
            <button
              @click="editMode = true"
              class="px-3 py-1.5 text-sm bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition"
            >
              ‚öôÔ∏è Edit
            </button>
            <button
              @click="createNewProfile()"
              class="px-3 py-1.5 text-sm bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
            >
              + New
            </button>
          </div>
        </div>
        <div class="flex gap-2 flex-wrap">
          <template
            x-for="profile in profiles"
            :key="profile.id"
          >
            <button
              @click="switchProfile(profile.id)"
              class="px-3 py-1.5 text-sm rounded-lg transition"
              :class="activeProfile.id === profile.id 
                ? 'bg-indigo-500 text-white' 
                : 'bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600'"
              x-text="profile.name"
            ></button>
          </template>
        </div>
      </div>

      <!-- Mode Toggle -->
      <div
        class="bg-white dark:bg-slate-800 rounded-lg shadow-lg p-4 mb-4 glass-border glass-hover"
      >
        <div class="flex gap-2">
          <button
            @click="mode = 'standard'"
            class="flex-1 py-2 rounded-lg font-semibold transition"
            :class="mode === 'standard' 
              ? 'bg-indigo-500 text-white' 
              : 'bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600'"
          >
            Standard (Calculate Profit)
          </button>
          <button
            @click="mode = 'reverse'"
            class="flex-1 py-2 rounded-lg font-semibold transition"
            :class="mode === 'reverse' 
              ? 'bg-purple-500 text-white' 
              : 'bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600'"
          >
            Reverse (Target Price)
          </button>
        </div>
      </div>

      <!-- Reverse Mode Target -->
      <div
        x-show="mode === 'reverse'"
        x-cloak
        class="bg-white dark:bg-slate-800 rounded-lg shadow-lg p-4 mb-4"
      >
        <h3 class="font-bold mb-3">Set Your Target</h3>
        <div class="flex gap-2 mb-3">
          <button
            @click="targetType = 'fixed'"
            class="flex-1 py-2 rounded-lg font-semibold transition text-sm"
            :class="targetType === 'fixed' 
              ? 'bg-purple-500 text-white' 
              : 'bg-gray-200 dark:bg-slate-700'"
          >
            Fixed <span x-text="activeProfile.currency"></span>
          </button>
          <button
            @click="targetType = 'margin'"
            class="flex-1 py-2 rounded-lg font-semibold transition text-sm"
            :class="targetType === 'margin' 
              ? 'bg-purple-500 text-white' 
              : 'bg-gray-200 dark:bg-slate-700'"
          >
            % Margin
          </button>
        </div>
        <input
          x-show="targetType === 'fixed'"
          type="number"
          step="0.01"
          x-model.number="targetFixed"
          :placeholder="'Target profit in ' + activeProfile.currency"
          class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-purple-500 glass-input"
        />
        <input
          x-show="targetType === 'margin'"
          type="number"
          step="0.01"
          x-model.number="targetMargin"
          placeholder="Target margin %"
          class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-purple-500 glass-input"
        />
      </div>

      <!-- Transaction Details -->
      <div
        class="bg-white dark:bg-slate-800 rounded-lg shadow-lg p-4 mb-4 glass-border glass-hover"
      >
        <h3 class="font-bold mb-3">Transaction Details</h3>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium mb-1"
              >Quantity / Amount</label
            >
            <input
              type="number"
              step="1"
              x-model.number="quantity"
              class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 glass-input"
            />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">
              Supplier Cost (Per Unit)
              <span x-text="'(' + activeProfile.currency + ')'"></span>
            </label>
            <input
              type="number"
              step="0.01"
              x-model.number="costPerUnit"
              class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 glass-input"
            />
          </div>

          <!-- Standard Mode: Selling Price with Price/Percentage Toggle -->
          <div
            x-show="mode === 'standard'"
            x-cloak
          >
            <label class="block text-sm font-medium mb-1">
              Selling Price (Per Unit)
            </label>
            <div class="flex gap-2 mb-2">
              <button
                @click="sellingPriceMode = 'price'"
                class="flex-1 py-1.5 rounded-lg font-semibold transition text-sm"
                :class="sellingPriceMode === 'price' 
                  ? 'bg-indigo-500 text-white' 
                  : 'bg-gray-200 dark:bg-slate-700'"
              >
                Fixed <span x-text="activeProfile.currency"></span>
              </button>
              <button
                @click="sellingPriceMode = 'percentage'"
                class="flex-1 py-1.5 rounded-lg font-semibold transition text-sm"
                :class="sellingPriceMode === 'percentage' 
                  ? 'bg-indigo-500 text-white' 
                  : 'bg-gray-200 dark:bg-slate-700'"
              >
                % Margin
              </button>
            </div>
            <input
              x-show="sellingPriceMode === 'price'"
              type="number"
              step="0.01"
              x-model.number="sellingPrice"
              :placeholder="'Price in ' + activeProfile.currency"
              class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 glass-input"
            />
            <input
              x-show="sellingPriceMode === 'percentage'"
              type="number"
              step="0.01"
              x-model.number="sellingPricePercentage"
              placeholder="Profit margin %"
              class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 glass-input"
            />
          </div>

          <!-- Reverse Mode: Auto-calculated price -->
          <div
            x-show="mode === 'reverse'"
            x-cloak
          >
            <label class="block text-sm font-medium mb-1">
              Selling Price (Per Unit)
              <span x-text="'(' + activeProfile.currency + ')'"></span>
            </label>
            <input
              type="text"
              :value="formatNumber(computedSellingPrice)"
              readonly
              class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-gray-100 dark:bg-slate-900 text-gray-600 dark:text-gray-300 cursor-not-allowed glass-input"
              placeholder="Auto-Calculated"
            />
          </div>
        </div>
      </div>

      <!-- Platform Fees -->
      <div
        class="bg-white dark:bg-slate-800 rounded-lg shadow-lg p-4 mb-4 glass-border glass-hover"
      >
        <h3 class="font-bold mb-3">Platform Fees</h3>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium mb-1"
              >Percentage Fee (%)</label
            >
            <input
              type="number"
              step="0.01"
              x-model.number="feePercent"
              class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 glass-input"
            />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">
              Fixed Fee
              <span x-text="'(' + activeProfile.currency + ')'"></span>
            </label>
            <input
              type="number"
              step="0.01"
              x-model.number="feeFixed"
              class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 glass-input"
            />
          </div>
        </div>
      </div>

      <!-- Results Breakdown -->
      <div
        class="bg-white dark:bg-slate-800 rounded-lg shadow-lg p-4 mb-4 glass-border glass-hover"
      >
        <h3 class="font-bold mb-3">Breakdown</h3>
        <div class="space-y-2 text-sm">
          <div
            x-show="mode === 'reverse'"
            class="flex justify-between p-2 bg-purple-50 dark:bg-purple-900/20 rounded"
          >
            <span class="font-semibold">Target Mode</span>
            <span
              x-text="targetType === 'fixed' ? 'Fixed ' + activeProfile.currency : 'Margin %'"
            ></span>
          </div>
          <div
            class="flex justify-between p-2 bg-gray-50 dark:bg-slate-700/50 rounded"
          >
            <span>Total Revenue</span>
            <span
              x-text="activeProfile.currency + ' ' + formatNumber(totalRevenue)"
            ></span>
          </div>
          <div
            class="flex justify-between p-2 bg-gray-50 dark:bg-slate-700/50 rounded"
          >
            <span>Total Cost (Buy)</span>
            <span
              x-text="activeProfile.currency + ' ' + formatNumber(totalCost)"
            ></span>
          </div>
          <div
            class="flex justify-between p-2 bg-gray-50 dark:bg-slate-700/50 rounded"
          >
            <span>Total Fees</span>
            <span
              x-text="activeProfile.currency + ' ' + formatNumber(totalFees)"
            ></span>
          </div>
          <div
            class="flex justify-between p-3 rounded font-bold text-lg"
            :class="netProfit >= 0 
              ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300' 
              : 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'"
          >
            <span>Net Profit</span>
            <span
              x-text="activeProfile.currency + ' ' + formatNumber(netProfit)"
            ></span>
          </div>
          <div
            class="flex justify-between p-2 bg-gray-50 dark:bg-slate-700/50 rounded"
          >
            <span>Margin</span>
            <span x-text="formatNumber(marginPercent) + '%'"></span>
          </div>
          <div
            class="flex justify-between p-2 bg-blue-50 dark:bg-blue-900/20 rounded"
          >
            <span>Break Even</span>
            <span
              x-text="activeProfile.currency + ' ' + formatNumber(breakEven)"
            ></span>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-2">
        <button
          @click="copyResult()"
          class="flex-1 py-3 bg-indigo-500 text-white rounded-lg font-semibold hover:bg-indigo-600 transition anim-pulse"
        >
          üìã Copy Result
        </button>
        <button
          @click="resetForm()"
          class="px-6 py-3 bg-gray-300 dark:bg-slate-700 text-gray-800 dark:text-gray-100 rounded-lg font-semibold hover:bg-gray-400 dark:hover:bg-slate-600 transition"
        >
          ‚Ü∫ Reset
        </button>
      </div>
    </main>

    <!-- Edit Profile Modal -->
    <div
      x-show="editMode"
      x-cloak
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
      @click.self="editMode = false"
    >
      <div
        class="bg-white dark:bg-slate-800 rounded-lg shadow-xl p-6 max-w-md w-full"
      >
        <h3 class="font-bold text-xl mb-4">Edit Profile</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">Profile Name</label>
            <input
              type="text"
              x-model="activeProfile.name"
              class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 glass-input"
            />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1"
              >Currency/Unit Name</label
            >
            <input
              type="text"
              x-model="activeProfile.currency"
              placeholder="e.g., $, ‚Ç¨, ¬•, THB, Gold"
              class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 glass-input"
            />
          </div>
          <button
            @click="deleteProfile()"
            :disabled="profiles.length <= 1"
            class="w-full py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Delete Profile
          </button>
          <button
            @click="saveProfile()"
            class="w-full py-3 bg-indigo-500 text-white rounded-lg font-semibold hover:bg-indigo-600 transition"
          >
            Done
          </button>
        </div>
      </div>
    </div>

    <script>
      function appData() {
        return {
          darkMode: false,
          mode: "standard",
          editMode: false,

          // Selling price mode for standard calculation
          sellingPriceMode: "price", // 'price' or 'percentage'
          sellingPricePercentage: 0,

          // Reverse mode
          targetType: "fixed",
          targetFixed: 0,
          targetMargin: 0,

          // Transaction data
          quantity: 0,
          costPerUnit: 0,
          sellingPrice: 0,
          feePercent: 0,
          feeFixed: 0,

          // Profiles
          profiles: [],
          activeProfileId: null,

          get activeProfile() {
            return (
              this.profiles.find((p) => p.id === this.activeProfileId) ||
              this.profiles[0]
            );
          },

          get effectiveSellingPrice() {
            if (this.mode === "standard") {
              if (this.sellingPriceMode === "percentage") {
                // Calculate selling price from percentage margin
                return (
                  this.costPerUnit * (1 + this.sellingPricePercentage / 100)
                );
              }
              return this.sellingPrice;
            }
            return this.computedSellingPrice;
          },

          get totalRevenue() {
            return this.quantity * this.effectiveSellingPrice;
          },

          get totalCost() {
            return this.quantity * this.costPerUnit;
          },

          get totalFees() {
            return (this.totalRevenue * this.feePercent) / 100 + this.feeFixed;
          },

          get netProfit() {
            return this.totalRevenue - this.totalCost - this.totalFees;
          },

          get marginPercent() {
            return this.totalRevenue > 0
              ? (this.netProfit / this.totalRevenue) * 100
              : 0;
          },

          get breakEven() {
            const feeMultiplier = 1 - this.feePercent / 100;
            if (feeMultiplier <= 0) return 0;
            return (
              (this.totalCost + this.feeFixed) / (this.quantity * feeMultiplier)
            );
          },

          get computedSellingPrice() {
            if (this.mode !== "reverse") return 0;

            const feeMultiplier = 1 - this.feePercent / 100;
            if (feeMultiplier <= 0 || this.quantity === 0) return 0;

            if (this.targetType === "fixed") {
              return (
                (this.totalCost + this.feeFixed + this.targetFixed) /
                (this.quantity * feeMultiplier)
              );
            } else {
              const targetMarginDecimal = this.targetMargin / 100;
              if (targetMarginDecimal >= 1) return 0;
              return (
                (this.totalCost + this.feeFixed) /
                (this.quantity * (feeMultiplier - targetMarginDecimal))
              );
            }
          },

          initData() {
            const saved = localStorage.getItem("currencyCalcData");
            if (saved) {
              const data = JSON.parse(saved);
              this.darkMode = data.darkMode || false;
              this.profiles = data.profiles || [
                { id: 1, name: "Default Profile", currency: "$" },
              ];
              this.activeProfileId =
                data.activeProfileId || this.profiles[0].id;
            } else {
              this.profiles = [
                { id: 1, name: "Default Profile", currency: "$" },
              ];
              this.activeProfileId = 1;
            }
          },

          saveData() {
            const data = {
              darkMode: this.darkMode,
              profiles: this.profiles,
              activeProfileId: this.activeProfileId,
            };
            localStorage.setItem("currencyCalcData", JSON.stringify(data));
          },

          toggleDark() {
            this.darkMode = !this.darkMode;
            this.saveData();
          },

          switchProfile(id) {
            this.activeProfileId = id;
            this.resetForm();
            this.saveData();
          },

          createNewProfile() {
            const newId = Math.max(...this.profiles.map((p) => p.id)) + 1;
            this.profiles.push({
              id: newId,
              name: "New Profile",
              currency: "$",
            });
            this.activeProfileId = newId;
            this.editMode = true;
            this.saveData();
          },

          saveProfile() {
            this.editMode = false;
            this.saveData();
          },

          deleteProfile() {
            if (this.profiles.length <= 1) return;
            this.profiles = this.profiles.filter(
              (p) => p.id !== this.activeProfileId
            );
            this.activeProfileId = this.profiles[0].id;
            this.editMode = false;
            this.saveData();
          },

          resetForm() {
            this.quantity = 0;
            this.costPerUnit = 0;
            this.sellingPrice = 0;
            this.sellingPricePercentage = 0;
            this.feePercent = 0;
            this.feeFixed = 0;
            this.targetFixed = 0;
            this.targetMargin = 0;
          },

          formatNumber(num) {
            return parseFloat(num.toFixed(2)).toLocaleString("en-US", {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            });
          },

          copyResult() {
            const curr = this.activeProfile.currency;
            let text = `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
`;
            text += `üìä ${this.activeProfile.name}
`;
            text += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

`;

            if (this.mode === "reverse") {
              text += `üéØ Mode: Reverse (Target Price)
`;
              text += `Target: ${
                this.targetType === "fixed"
                  ? curr + " " + this.formatNumber(this.targetFixed)
                  : this.formatNumber(this.targetMargin) + "%"
              }

`;
            } else {
              text += `üéØ Mode: Standard (Calculate Profit)

`;
            }

            text += `üì¶ Quantity: ${this.quantity}
`;
            text += `üí∞ Cost/Unit: ${curr} ${this.formatNumber(
              this.costPerUnit
            )}
`;
            text += `üíµ Sell/Unit: ${curr} ${this.formatNumber(
              this.effectiveSellingPrice
            )}
`;
            text += `üìä Fee %: ${this.formatNumber(this.feePercent)}%
`;
            text += `üí∏ Fixed Fee: ${curr} ${this.formatNumber(this.feeFixed)}

`;

            text += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`;
            text += `üìà Total Revenue: ${curr} ${this.formatNumber(
              this.totalRevenue
            )}
`;
            text += `üìâ Total Cost: ${curr} ${this.formatNumber(this.totalCost)}
`;
            text += `üí≥ Total Fees: ${curr} ${this.formatNumber(this.totalFees)}
`;
            text += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`;
            text += `‚ú® NET PROFIT: ${curr} ${this.formatNumber(this.netProfit)}
`;
            text += `üìä Margin: ${this.formatNumber(this.marginPercent)}%
`;
            text += `‚öñÔ∏è Break Even: ${curr} ${this.formatNumber(this.breakEven)}
`;
            text += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
`;

            navigator.clipboard.writeText(text).then(() => {
              alert("‚úÖ Result copied to clipboard!");
            });
          },

          exportData() {
            const exportObj = {
              version: "2.0",
              exportDate: new Date().toISOString(),
              darkMode: this.darkMode,
              profiles: this.profiles,
              activeProfileId: this.activeProfileId,
            };

            const dataStr = JSON.stringify(exportObj, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = `currency-calc-backup-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
          },

          importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const data = JSON.parse(e.target.result);
                if (data.profiles && Array.isArray(data.profiles)) {
                  this.profiles = data.profiles;
                  this.activeProfileId =
                    data.activeProfileId || this.profiles[0].id;
                  this.darkMode = data.darkMode || false;
                  this.saveData();
                  alert("‚úÖ Data imported successfully!");
                } else {
                  alert("‚ùå Invalid file format!");
                }
              } catch (err) {
                alert("‚ùå Error reading file!");
              }
            };
            reader.readAsText(file);
            event.target.value = "";
          },
        };
      }
    </script>
  </body>
</html>
